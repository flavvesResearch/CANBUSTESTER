<!DOCTYPE html>
<html lang="tr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>CAN Bus Tester</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="/static/theme.js" type="module"></script>
    <script src="/static/i18n.js" type="module"></script>
</head>
<body>
<header>
    <div class="header-top">
        <h1 data-i18n="app_title">CAN Bus Tester</h1>
        <div style="display: flex; gap: 1rem; align-items: center;">
            <div class="language-selector">
                <button id="lang-tr" class="active" data-lang="tr">TR</button>
                <button id="lang-en" data-lang="en">EN</button>
            </div>
            <button id="theme-toggle" class="theme-toggle" type="button" data-theme-toggle>
                ðŸŒ™ <span data-i18n="dark_mode">Koyu Mod</span>
            </button>
        </div>
    </div>
    <p data-i18n="app_description">DBC tabanlÄ± CAN mesajlarÄ±nÄ± web Ã¼zerinden oluÅŸtur, gÃ¶nder ve izle.</p>
</header>

<main>
    <section class="panel">
        <h2 data-i18n="can_interface">1. CAN ArayÃ¼zÃ¼</h2>
        <form id="interface-form" class="stack">
            <div class="field">
                <label for="interface" data-i18n="interface">ArayÃ¼z</label>
                <select id="interface" name="interface" required>
                    <option value="" data-i18n="loading_interfaces">ArayÃ¼zleri getiriliyorâ€¦</option>
                </select>
            </div>
            <div class="field">
                <label for="channel" data-i18n="channel">Kanal</label>
                <select id="channel" name="channel" required disabled>
                    <option value="" data-i18n="select_interface_first">Ã–nce arayÃ¼z seÃ§in</option>
                </select>
            </div>
            <div id="manual-interface-fields" class="field hidden">
                <label for="interface-manual" data-i18n="manual_interface">ArayÃ¼z (manuel)</label>
                <input id="interface-manual" placeholder="Ã¶r. socketcan">
            </div>
            <div id="manual-channel-fields" class="field hidden">
                <label for="channel-manual" data-i18n="manual_channel">Kanal (manuel)</label>
                <input id="channel-manual" placeholder="Ã¶r. can0">
            </div>
            <div class="field">
                <label for="bitrate" data-i18n="bitrate">Bit HÄ±zÄ± (bps)</label>
                <input id="bitrate" name="bitrate" type="number" value="500000">
            </div>
            <button type="submit" class="primary" data-i18n="start_connection">BaÄŸlantÄ±yÄ± BaÅŸlat</button>
        </form>
        <div id="interface-status" class="status-card"></div>
    </section>

    <section class="panel">
        <h2 data-i18n="load_dbc">2. DBC YÃ¼kle</h2>
        <form id="dbc-form" class="stack" enctype="multipart/form-data">
            <label class="file-picker">
                <input id="dbc-file" name="file" type="file" accept=".dbc" required>
                <span id="dbc-file-label" data-i18n="select_file">Dosya seÃ§in</span>
            </label>
            <button type="submit" data-i18n="upload">YÃ¼kle</button>
        </form>
        <div id="dbc-status" class="status-card"></div>
    </section>

    <section class="panel message-panel full-width">
        <h2 data-i18n="create_message">3. Mesaj OluÅŸtur</h2>
        <form id="message-form" class="message-grid">
            <div class="message-config">
                <div id="message-selector" class="field">
                    <label for="message-list" data-i18n="message">Mesaj</label>
                    <select id="message-list" disabled>
                        <option data-i18n="load_dbc_first">Ã–nce DBC yÃ¼kleyin</option>
                    </select>
                </div>
                <div id="message-comment" class="help-text"></div>
                <div class="field inline">
                    <label for="period" data-i18n="period_ms">Periyot (ms)</label>
                    <input id="period" name="period" type="number" min="0" data-i18n-placeholder="period_placeholder">
                </div>
                <div class="bulk-actions">
                    <div class="field">
                        <label for="bulk-value" data-i18n="bulk_signal_value">Toplu Sinyal DeÄŸeri</label>
                        <input id="bulk-value" name="bulk-value" type="number" step="any" data-i18n-placeholder="bulk_value_placeholder">
                    </div>
                    <div class="bulk-buttons">
                        <button id="apply-bulk" type="button" class="secondary" data-i18n="apply_all">TÃ¼mÃ¼nÃ¼ Uygula</button>
                        <button id="fill-ones" type="button" class="secondary" data-i18n="all_ones">Hepsi 1</button>
                        <button id="fill-zeros" type="button" class="secondary" data-i18n="all_zeros">Hepsi 0</button>
                    </div>
                </div>
                <div class="signal-chaser">
                    <div class="field inline">
                        <label for="signal-chaser-interval" data-i18n="signal_chaser_interval">Tarama SÃ¼resi (sn)</label>
                        <input id="signal-chaser-interval" type="number" min="0.1" step="0.1" value="3">
                    </div>
                    <div class="chaser-mode">
                        <label>
                            <input type="radio" name="chaser-mode" value="signals" checked>
                            <span data-i18n="chaser_mode_signals">Sinyal taramasÄ±</span>
                        </label>
                        <label>
                            <input type="radio" name="chaser-mode" value="codes">
                            <span data-i18n="chaser_mode_codes">Hata kodu taramasÄ±</span>
                        </label>
                    </div>
                    <div id="chaser-code-options" class="code-options hidden">
                        <div class="code-source">
                            <label>
                                <input type="radio" name="code-source" value="excel" checked>
                                <span data-i18n="code_source_excel">Excel ile gÃ¶nder</span>
                            </label>
                            <label>
                                <input type="radio" name="code-source" value="excel-decimal">
                                <span data-i18n="code_source_excel_decimal">Excel ile decimal gÃ¶nder</span>
                            </label>
                            <label>
                                <input type="radio" name="code-source" value="manual">
                                <span data-i18n="code_source_manual">Manuel aralÄ±k</span>
                            </label>
                        </div>
                        <div id="code-source-excel" class="code-source-panel">
                            <label class="file-picker">
                                <input id="code-excel-file" type="file" accept=".xlsx,.xls">
                                <span id="code-excel-label" data-i18n="code_excel_select">Excel dosyasÄ± seÃ§in</span>
                            </label>
                            <div id="code-excel-status" class="help-text" data-i18n="code_excel_help">DosyayÄ± yÃ¼kleyerek hata kodlarÄ±nÄ± getirin.</div>
                        </div>
                        <div id="code-source-excel-decimal" class="code-source-panel hidden">
                            <label class="file-picker">
                                <input id="code-excel-decimal-file" type="file" accept=".xlsx,.xls">
                                <span id="code-excel-decimal-label" data-i18n="code_excel_select">Excel dosyasÄ± seÃ§in</span>
                            </label>
                            <div id="decimal-signal-selector" class="field hidden">
                                <label for="decimal-target-signal" data-i18n="decimal_target_signal">Hedef Sinyal</label>
                                <select id="decimal-target-signal" disabled>
                                    <option data-i18n="select_message_first">Ã–nce mesaj seÃ§in</option>
                                </select>
                            </div>
                            <div id="code-excel-decimal-status" class="help-text" data-i18n="code_excel_help">DosyayÄ± yÃ¼kleyerek hata kodlarÄ±nÄ± getirin.</div>
                        </div>
                        <div id="code-source-manual" class="code-source-panel hidden">
                            <div class="field inline">
                                <label for="code-range-start" data-i18n="code_range_start">BaÅŸlangÄ±Ã§ (hex)</label>
                                <input id="code-range-start" data-i18n-placeholder="code_range_placeholder" placeholder="Ã¶rn. 0x1F00">
                            </div>
                            <div class="field inline">
                                <label for="code-range-end" data-i18n="code_range_end">BitiÅŸ (hex)</label>
                                <input id="code-range-end" data-i18n-placeholder="code_range_placeholder" placeholder="Ã¶rn. 0x3251">
                            </div>
                            <div class="help-text" data-i18n="code_manual_help">BaÅŸlangÄ±Ã§ ve bitiÅŸ deÄŸerlerini hex formatÄ±nda girin.</div>
                        </div>
                    </div>
                    <div class="chaser-buttons">
                        <button id="chaser-start" type="button" class="secondary" data-i18n="start_signal_chaser">Sinyal TaramasÄ±nÄ± BaÅŸlat</button>
                        <button id="chaser-stop" type="button" class="secondary" disabled data-i18n="stop_chaser">Tarama Durdur</button>
                    </div>
                    <div id="chaser-status" class="help-text" data-i18n="chaser_ready">Tarama hazÄ±r.</div>
                </div>
                <div class="actions">
                    <button type="submit" class="primary" data-i18n="send">GÃ¶nder</button>
                    <button id="stop-periodic" type="button" class="secondary" disabled data-i18n="stop">Durdur</button>
                </div>
                <div id="message-feedback" class="help-text"></div>
            </div>
            <div class="message-signals">
                <div id="signals-container"></div>
            </div>
        </form>
    </section>

    <section class="panel full-width">
        <h2 data-i18n="fault_injection">4. Hata Enjeksiyon Testleri</h2>
        <div class="fault-injection-panel">
            <div class="fault-config">
                <div class="field">
                    <label for="fault-message-list" data-i18n="message">Mesaj</label>
                    <select id="fault-message-list" disabled>
                        <option data-i18n="load_dbc_first">Ã–nce DBC yÃ¼kleyin</option>
                    </select>
                </div>
                <div class="fault-types">
                    <label data-i18n="fault_type">Hata Tipi</label>
                    <div class="fault-type-options">
                        <label>
                            <input type="radio" name="fault-type" value="bit-flip" checked>
                            <span data-i18n="fault_bit_flip">Rastgele Bit HatasÄ±</span>
                        </label>
                        <label>
                            <input type="radio" name="fault-type" value="dlc-mismatch">
                            <span data-i18n="fault_dlc_mismatch">DLC UyumsuzluÄŸu</span>
                        </label>
                        <label>
                            <input type="radio" name="fault-type" value="out-of-range">
                            <span data-i18n="fault_out_of_range">SÄ±nÄ±r DÄ±ÅŸÄ± DeÄŸerler</span>
                        </label>
                        <label>
                            <input type="radio" name="fault-type" value="random-data">
                            <span data-i18n="fault_random_data">Rastgele Veri</span>
                        </label>
                        <label>
                            <input type="radio" name="fault-type" value="zero-data">
                            <span data-i18n="fault_zero_data">SÄ±fÄ±r Veri</span>
                        </label>
                        <label>
                            <input type="radio" name="fault-type" value="max-data">
                            <span data-i18n="fault_max_data">Maksimum Veri</span>
                        </label>
                    </div>
                </div>
                <div id="fault-bit-flip-config" class="fault-config-panel">
                    <div class="field inline">
                        <label for="bit-flip-count" data-i18n="bit_flip_count">Bozulacak Bit SayÄ±sÄ±</label>
                        <input id="bit-flip-count" type="number" min="1" max="64" value="1">
                    </div>
                    <div class="help-text" data-i18n="bit_flip_help">Verinin rastgele bitlerini deÄŸiÅŸtirir.</div>
                </div>
                <div id="fault-dlc-config" class="fault-config-panel hidden">
                    <div class="field inline">
                        <label for="dlc-value" data-i18n="dlc_value">DLC DeÄŸeri</label>
                        <input id="dlc-value" type="number" min="0" max="8" value="8">
                    </div>
                    <div class="help-text" data-i18n="dlc_help">GerÃ§ek veri uzunluÄŸundan farklÄ± DLC gÃ¶nderir.</div>
                </div>
                <div id="fault-range-config" class="fault-config-panel hidden">
                    <div class="field">
                        <label for="fault-target-signal" data-i18n="target_signal">Hedef Sinyal</label>
                        <select id="fault-target-signal" disabled>
                            <option data-i18n="select_message_first">Ã–nce mesaj seÃ§in</option>
                        </select>
                    </div>
                    <div class="field inline">
                        <label for="range-multiplier" data-i18n="range_multiplier">SÄ±nÄ±r AÅŸÄ±m Ã‡arpanÄ±</label>
                        <input id="range-multiplier" type="number" min="1.1" max="100" step="0.1" value="2">
                    </div>
                    <div class="help-text" data-i18n="range_help">SeÃ§ilen sinyale min/max sÄ±nÄ±rlarÄ±nÄ± aÅŸan deÄŸer atar.</div>
                </div>
                <div class="field inline">
                    <label for="fault-interval" data-i18n="fault_interval">GÃ¶nderim AralÄ±ÄŸÄ± (sn)</label>
                    <input id="fault-interval" type="number" min="0.1" step="0.1" value="1">
                </div>
                <div class="field inline">
                    <label for="fault-count" data-i18n="fault_count">Toplam GÃ¶nderim SayÄ±sÄ±</label>
                    <input id="fault-count" type="number" min="1" max="10000" value="10">
                </div>
                <div class="fault-buttons">
                    <button id="fault-start" type="button" class="primary" data-i18n="start_fault_test">Hata Testini BaÅŸlat</button>
                    <button id="fault-stop" type="button" class="secondary" disabled data-i18n="stop_fault_test">Testi Durdur</button>
                </div>
                <div id="fault-status" class="status-card"></div>
            </div>
        </div>
    </section>

    <section class="panel full-width">
        <h2 data-i18n="can_monitor">CAN Ä°zleme</h2>
        <div class="record-controls">
            <div class="record-controls__row">
                <div class="field">
                    <label for="record-name" data-i18n="recording_name">KayÄ±t AdÄ±</label>
                    <input id="record-name" data-i18n-placeholder="auto_name">
                </div>
                <div class="record-buttons">
                    <button id="record-start" type="button" class="primary" data-i18n="start_recording">KaydÄ± BaÅŸlat</button>
                    <button id="record-stop" type="button" class="secondary" disabled data-i18n="stop_recording">KaydÄ± Durdur</button>
                    <a class="link-button" href="/playback" target="_blank" rel="noopener" data-i18n="open_recordings">KayÄ±tlarÄ± AÃ§</a>
                </div>
            </div>
            <div id="record-status" class="help-text" data-i18n="recording_waiting">KayÄ±t beklemede.</div>
            <div id="recordings-list" class="recordings-list"></div>
        </div>
        <div id="monitor-log"></div>
    </section>
</main>

<footer>
    <p data-i18n="footer_text">Web arayÃ¼zÃ¼ FastAPI + WebSocket altyapÄ±sÄ± ile Ã§alÄ±ÅŸmaktadÄ±r.</p>
</footer>

<script src="/static/app.js" type="module"></script>
</body>
</html>
